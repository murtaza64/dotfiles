#!/bin/bash

# Tmux wrapper that runs transcription in a popup and pastes output

SCRIPT_DIR="$(dirname "$0")"
TRANSCRIBE_SCRIPT="$SCRIPT_DIR/transcribe"
TEMP_FILE=$(mktemp)

# Cleanup temp file on exit
trap "rm -f $TEMP_FILE" EXIT

# Run transcription in tmux popup, redirecting output to temp file
tmux display-popup -Ew60% -h20% -b rounded -S fg=cyan -T "speech to text" "$TRANSCRIBE_SCRIPT > $TEMP_FILE"

# If we got output, load it into tmux buffer and paste
if [ -s "$TEMP_FILE" ]; then
    # Load output into tmux buffer
    tmux load-buffer -b transcription "$TEMP_FILE"
    # Paste into current client
    tmux paste-buffer -pb transcription
fi
