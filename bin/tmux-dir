#!/usr/bin/env bash

# Use walcolor if available, fallback to hardcoded colors
if command -v walcolor >/dev/null 2>&1; then
  color1=$(walcolor 1 2>/dev/null)
  color2=$(walcolor 2 2>/dev/null)
  
  if [[ -n "$color2" ]]; then
    ORANGE="#[fg=$color2]"
  else
    ORANGE='#[fg=3]'
  fi
  
  if [[ -n "$color1" ]]; then
    MAGENTA="#[fg=$color1]"
  else
    MAGENTA='#[fg=5]'
  fi
else
  ORANGE='#[fg=3]'
  MAGENTA='#[fg=5]'
fi
session=$(tmux display-message -p '#S' | sed -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//')
# get directory relative to ~
dir=$(tmux display-message -p "#{pane_current_path}" \
  | sed -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//' \
  | sed -e "s|^$HOME/||")

if [ "$dir" != "$session" ]; then
  absolute_dir=$(realpath $HOME/$dir)
  if echo $absolute_dir | grep -q "^$HOME/$session/"; then
    relative_dir=$(echo $dir | sed -e "s|^$session/||")
    echo " $MAGENTA$session$ORANGE/$relative_dir"
  else
    echo " $MAGENTA$session$ORANGE ï„”  $dir"
  fi
else
  echo " $MAGENTA$session"
fi
