#!/bin/bash

# Set wallpaper and generate colors with pywal
# Usage: wallpaper [file]
#   - If file is provided, use that specific wallpaper
#   - Otherwise, use the wallpapers directory for random selection

cd ~/pywal

if [ $# -eq 1 ]; then
    if [ "$1" = "--shuffle" ]; then
        # Shuffle mode - let pywal pick randomly from directory
        uv run -m pywal --backend colorthief --ansi-match --cols16 lighten -i ~/wallpapers/ > /dev/null 2>&1
    else
        # Use provided file
        WALLPAPER="$1"
        
        # Check if file exists
        if [ ! -f "$WALLPAPER" ]; then
            echo "Wallpaper file not found: $WALLPAPER"
            exit 1
        fi
        
        uv run -m pywal --backend colorthief --ansi-match --cols16 lighten -i "$WALLPAPER" > /dev/null 2>&1
    fi
else
    # No arguments - use fzf to select wallpaper
    WALLPAPER=$(find ~/wallpapers/ -type f -exec basename {} \; -print | \
                paste - - | \
                fzf --with-nth=1 \
                    --delimiter=$'\t' | \
                cut -f2)
                    # --preview 'identify {2} && kitten icat {2}' \
                    # --preview-window up | \
    
    if [ -n "$WALLPAPER" ]; then
        uv run -m pywal --backend colorthief --ansi-match --cols16 lighten -i "$WALLPAPER" > /dev/null 2>&1
    else
        echo "No wallpaper selected"
        exit 1
    fi
fi
