#!/bin/bash

# Set wallpaper and generate colors with pywal
# Usage: wallpaper [filename|options...]
#   - No arguments: random wallpaper from ~/wallpapers
#   - First arg is filename: use as wallpaper (-i filename)
#   - First arg is option/flag: use current wallpaper with additional args

cd ~/pywal

# Default pywal options
DEFAULT_OPTS="--backend colorthief --shading lighten --contrast 1.5"

if [ $# -eq 0 ]; then
    # No arguments - random wallpaper
    uv run -m pywal $DEFAULT_OPTS -i ~/wallpapers/
elif [[ "$1" == -* ]]; then
    # First argument is an option/flag - regenerate palette for current wallpaper
    CURRENT_WALLPAPER=$(cat ~/.cache/wal/wal 2>/dev/null)
    if [ -n "$CURRENT_WALLPAPER" ] && [ -f "$CURRENT_WALLPAPER" ]; then
        uv run -m pywal $DEFAULT_OPTS -i "$CURRENT_WALLPAPER" --no-cache "$@"
    else
        echo "No current wallpaper found or file doesn't exist"
        exit 1
    fi
else
    # First argument is filename
    WALLPAPER="$1"
    shift  # Remove filename from arguments
    
    # Check if file exists
    if [ ! -f "$WALLPAPER" ]; then
        echo "Wallpaper file not found: $WALLPAPER"
        exit 1
    fi
    
    uv run -m pywal $DEFAULT_OPTS -i "$WALLPAPER" "$@"
fi
