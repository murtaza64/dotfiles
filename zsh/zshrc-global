# ZSH_ROOT=~/.config/zsh
# This should be set in .zshenv

# move prompt to bottom
printf '\n%.0s' {1..100}

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

autoload -Uz compinit
compinit
ZSHRCLOG=0
function log {
    if [[ $ZSHRCLOG -ne 0 ]]; then
        echo "zshrc: $1"
    fi
}

# borrowed from oh-my-zsh
# init some plugins, options and prompt theme
ZSH_ALIAS_FINDER_AUTOMATIC=true
# for zshfile ($ZSH_ROOT/*.zsh); do
#     source $zshfile
# done

source $ZSH_ROOT/aliases.plugin.zsh
source $ZSH_ROOT/completion.zsh
source $ZSH_ROOT/git.zsh
source $ZSH_ROOT/git.plugin.zsh
source $ZSH_ROOT/history.zsh
source $ZSH_ROOT/key-bindings.zsh
source $ZSH_ROOT/spectrum.zsh
source $ZSH_ROOT/termsupport.zsh
source $ZSH_ROOT/theme-and-appearance.zsh

# source $ZSH_ROOT/murtaza.zsh-theme

source $ZSH_ROOT/powerlevel10k/powerlevel10k.zsh-theme

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f $ZSH_ROOT/.p10k.zsh ]] || source $ZSH_ROOT/.p10k.zsh

# custom aliases
alias less='less --mouse --wheel-lines 3'
export PAGER='less --mouse --wheel-lines 3'
alias grep='grep --color=auto'

# don't beep when triggering menu complete
unsetopt LIST_BEEP

# fuck
if command -v thefuck >/dev/null; then
    eval $(thefuck --alias)
else
    log "thefuck not found"
fi

# pyenv
if [[ -a $HOME/.pyenv ]]; then
    export PYENV_ROOT="$HOME/.pyenv"
    command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init -)"
else
    log "pyenv not found"
fi

# fzf
if [[ -d "/usr/share/doc/fzf" ]]; then
    source /usr/share/doc/fzf/examples/completion.zsh
    source /usr/share/doc/fzf/examples/key-bindings.zsh
    # export FZF_DEFAULT_OPTS="--multi --bind 'ctrl-a:select-all'"
elif [[ -d "/usr/share/fzf" ]]; then
    source /usr/share/fzf/completion.zsh
    source /usr/share/fzf/key-bindings.zsh
else
    log "fzf not found"
fi

function show_colors {
    for i in {0..255}; do 
        print -Pn "%K{$i}  %k%F{$i}${(l:3::0:)i}%f " ${${(M)$((i%6)):#3}:+$'\n'}
    done
}

# My history widget is made obsolete by builtin fzf functionality :(
# function h {
#     local fzf_options=(--border=rounded --border-label="zsh history" 
#          --border-label-pos=bottom)
#     if [ "$#" -eq 0 ]; then
#         local cmd=$(history | sed "s/^[ \t]*//" \
#             | sed "s/^[0-9*]\+\s\+//" | tac | awk '!seen[$0]++' | fzf $fzf_options --tiebreak=index)
#     else
#         local cmd=$(history | sed "s/^[ \t]*//" \
#             | sed "s/^[0-9*]\+\s\+//" | tac | awk '!seen[$0]++' | fzf $fzf_options \
#             --tiebreak=index -q ${(j[ ])@})
#     fi
#     if [[ ! -z $cmd ]]; then
#         zle -U $cmd 2> /dev/null || print -z $cmd
#     else
#         return 2
#     fi
# }
# zle -N interactive-history h
# bindkey '^[h' interactive-history
